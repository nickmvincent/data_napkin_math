<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Napkin Math</title>
  
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" />
  
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
  
  <!-- Chart.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
  
  <!-- Main CSS -->
  <link rel="stylesheet" href="assets/css/main.css" />
  
  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3"></script>
</head>

<body>
  <!-- Fixed-top Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="#headerContent">Data Napkin Math</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="#napkinMath">Scenarios</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#aboutContent">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/nickmvincent/data_napkin_math" target="_blank">GitHub</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Vue App Container -->
  <div id="app" style="padding-top: 70px;">
    <!-- Top Toolbar -->
    <div class="toolbar">
      <button class="btn btn-primary" @click="toggleLeftPanel">
        {{ leftPanelOpen ? "Hide Inputs" : "Show Inputs" }}
      </button>
      <button class="btn btn-primary" @click="toggleRightPanel">
        {{ inspectorButtonText }}
      </button>
    </div>

    <!-- Category Selector -->
    <div class="container my-3">
      <category-selector 
        :categories="uniqueCategories" 
        :selected-category="selectedScenario"
        @category-selected="toggleCategory"
      ></category-selector>
    </div>

    <!-- Loading & Error States -->
    <div v-if="isLoading" class="container text-center my-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3">Loading data...</p>
    </div>

    <div v-else-if="error" class="container my-5">
      <div class="alert alert-danger">
        <h4 class="alert-heading">Error Loading Data</h4>
        <p>{{ error }}</p>
        <hr>
        <p class="mb-0">Please check the console for more details or try again later.</p>
      </div>
    </div>

    <!-- Main Flex Container: Left Panel & Main Content -->
    <div v-else class="main-container">
      <!-- Left Panel: Inputs -->
      <input-panel 
        :inputs="inputs" 
        :visible="leftPanelOpen"
        @update-value="updateValue"
        @adjust-value="adjustValue"
        @reset-value="resetValue"
        @inspect="showDetails"
      ></input-panel>

      <!-- Main Content: Scenario Cards -->
      <div class="main-content" :style="{ marginRight: (!isMobile && rightPanelOpen) ? '400px' : '0' }">
        <header id="headerContent" class="page-header">
          <h1>Napkin Math for Training Data Value</h1>
          <p>
            Napkin math, back-of-the-envelope estimates, and ballpark figures – this interactive page explores
            order-of-magnitude estimates for important "data value" questions.
            How will the proceeds and benefits of AI be distributed?
          </p>
        </header>

        <section id="napkinMath">
          <h2 style="margin-top: 40px; margin-bottom: 20px;">Scenarios</h2>
          <p style="font-size: 1.1rem; margin-bottom: 30px;">
            Explore the various scenarios below. Modify input values and choose fill options to see how outcomes change.
          </p>
          
          <!-- Scenario Cards -->
          <scenario-card
            v-for="(scenario, index) in filteredScenarios"
            :key="index"
            :scenario="scenario"
            :index="index"
            :inputs="inputs"
            :fill-selections="fillSelections"
            @toggle-explore="toggleExplore"
            @update-value="updateValue"
            @adjust-value="adjustValue"
            @reset-value="resetValue"
            @inspect-input="showDetails"
            @variable-change="onCardDropdownChange"
            @generate-plot="generateSensitivityPlot"
          ></scenario-card>
        </section>

        <section id="aboutContent" class="about-section">
          <details open>
            <summary>About this page</summary>
            <div style="margin-top: 10px; line-height: 1.6;">
              <p>
                <strong>This website is in an early beta state!</strong> Head over to our GitHub page for details and to
                contribute.
                There are many open debates about policy and norms around the use of data for AI systems – and often,
                back-of-the-envelope estimates like these are the starting point.
              </p>
              <p>
                This interactive tool allows you to adjust assumptions and play with the numbers. The underlying math is
                simple arithmetic, yet it provides a framework to reason about order-of-magnitude estimates.
              </p>
              <p>
                To participate in the discussion regarding reasonable default values, check out the
                <a href="https://github.com/nickmvincent/data_napkin_math" target="_blank">GitHub page</a> or leave a
                comment in our public folder.
              </p>
            </div>
          </details>
        </section>
      </div>

      <!-- Right Panel: Inspector -->
      <inspector-panel
        :selected-key="selectedInputKey"
        :inputs="inputs"
        :logs="logs"
        :visible="rightPanelOpen"
        :is-mobile="isMobile"
        @close="toggleRightPanel"
      ></inspector-panel>
    </div>
  </div>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
  
  <!-- Main App Script (module type to use ES6 imports) -->
  <script type="module" src="js/main.js"></script>
</body>

</html>