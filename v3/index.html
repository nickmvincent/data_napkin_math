<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Napkin Math</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
    <script src="https://unpkg.com/vue@3"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.0.0/js-yaml.min.js"></script>
    <style>
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            font-family: 'Roboto', Arial, sans-serif;
            overflow: hidden;
        }

        #app {
            display: flex;
            flex-direction: row;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .sidebar {
            width: 300px;
            background: #f8f9fa;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            overflow-y: auto;
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            transform: translateX(-100%);
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            transition: margin-left 0.3s ease;
            margin-left: 0;
        }

        .main-content.shifted {
            margin-left: 300px;
        }

        .sidebar-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .card {
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 10px;
            background: #f9f9f9;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease;
        }

        .card:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .input-info {
            font-size: 0.9em;
            color: #6c757d;
        }

        .btn {
            transition: background-color 0.3s ease;
        }

        .btn:hover {
            background-color: #007bff;
            color: white;
        }
    </style>
</head>

<body>
    <div id="app">
        <button @click="toggleSidebar" class="btn btn-primary sidebar-toggle">
            {{ sidebarOpen ? 'Hide' : 'Show' }} ALL Assumptions
        </button>

        <div :class="['sidebar', { open: sidebarOpen }]">
            <h4>Adjust Inputs</h4>
            <div v-for="(input, key) in inputs" :key="key" class="mb-3">
                <label :for="key" class="form-label">{{ formatLabel(key) }} ({{ input.units }})</label>
                <input type="number" v-model.number="inputs[key].value" :id="key" class="form-control"
                    @input="updateCalculations">
                <p v-if="input.description" class="input-info">{{ input.description }}</p>
                <p class="input-info">Source: <a :href="input.source_url" target="_blank">{{ input.source_url }}</a></p>
            </div>
            <button @click="loadDataFromGist" class="btn btn-outline-primary mt-3">Load Data from Gist</button>
        </div>

        <div :class="['main-content', { shifted: sidebarOpen }]">
            <header class="header">
                <h1>Data Napkin Math for Training Data Value</h1>
                <p>This is a lightweight web-page for making order of magnitude estimates about profit distribution,
                    dataset creation costs, and data deals.
                </p>
                <button class="btn btn-link" type="button" @click="toggleHeaderContent">
                    {{ headerContentOpen ? 'Hide' : 'Show' }} Header Description
                </button>
                <div v-if="headerContentOpen" id="headerContent">
                    <p>
                        There are a number of open debates about making policy and setting norms around the use of data for "AI"
                        systems.
                    </p>
                    <p>
                        Many of these questions involve some abstract moral arguments, but answering them may also depend on
                        some
                        rough estimates
                        of "what kind of numbers are we talking about". Will people be getting $5000 paychecks, or 5 cent
                        pittances?
                    </p>
                    <p>
                        This tool is interactive so you can edit any assumptions you want. Ultimately, the math here is mostly
                        just
                        arithmetic (with the potential to hook more elaborate ML training scenarios or agent-based models)
                    </p>
                    <p>
                        To participate in discussion about what some reasonable default values should be, head to the GitHub
                        where we host the underlying data.
                    </p>
                    <p>
                        There are two types of objects we use here: reported figures, aka the "inputs" (for instance, the number of tokens used to train a model
                        or the reported revenue of an AI company) and equations. The idea is, anyone can contribute to this estimation process
                        by updating a figure (for instance, when a new paper comes out), contesting an equation, or adding a new scenario.
                    </p>
                </div>
            </header>

            <!-- Napkin Math Section -->
            <section id="napkinMath">
                <h2>Napkin Math Calculations</h2>
                <p>Below are our existing napkin math scenarios. For each scenario, you can play with the assumed values to
                    see how things might change.
                    You can also see and edit all the assumptions in the sidebar. To see exactly what's being calculated in
                    each scenario, hover over the description.
                </p>

                <!-- Calculation Cards -->
                <div v-for="(calculation, index) in calculations" :key="index" class="card">
                    <header>
                        <h4>{{ calculation.title }}</h4>
                        <p>
                            {{ calculation.description }}
                            <div class="tooltip-container explanation">
                                <a :href="calculation.diagram" target="_blank">View Diagram</a>
                            </div>
                        </p>
                    </header>
                    <div v-for="inputKey in calculation.inputs" :key="inputKey" class="mb-3">
                        <label :for="inputKey" class="form-label">{{ formatLabel(inputKey) }} ({{ inputs[inputKey].units }})</label>
                        <input type="number" v-model.number="inputs[inputKey].value" :id="inputKey" class="form-control"
                            @input="updateCalculations">
                    </div>
                    <details>
                        <summary>Show Details</summary>
                        <p><strong>Explanation:</strong> {{ calculation.explanation }}</p>
                        <ul v-for="inputKey in calculation.inputs" :key="inputKey" v-if="inputs[inputKey]">
                            <li><strong>Value Description:</strong> {{ inputs[inputKey]?.value_description }}</li>
                            <li><strong>Variable Type:</strong> {{ inputs[inputKey]?.variable_type }}</li>
                            <li><strong>Confidence in Number:</strong> {{ inputs[inputKey]?.confidence_in_number }}</li>
                            <li><strong>Key Assumption:</strong> {{ inputs[inputKey]?.key_assumption }}</li>
                            <li><strong>Source Notes:</strong> {{ inputs[inputKey]?.source_notes }}</li>
                        </ul>
                    </details>
                    <footer class="mt-4">
                        <p>{{ calculation.result.label }}: <strong>{{ calculation.result.value }}</strong></p>
                    </footer>
                </div>
            </section>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    <script>
        const app = Vue.createApp({
            data() {
                return {
                    sidebarOpen: false,
                    headerContentOpen: true,
                    inputs: {},
                    calculations: []
                };
            },
            methods: {
                toggleSidebar() {
                    this.sidebarOpen = !this.sidebarOpen;
                },
                toggleHeaderContent() {
                    this.headerContentOpen = !this.headerContentOpen;
                },
                formatLabel(key) {
                    return key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                },
                updateCalculations() {
                    this.calculations.forEach(calculation => {
                        const inputs = calculation.inputs.reduce((acc, key) => {
                            if (this.inputs[key]) {
                                acc[key] = this.inputs[key].value;
                            }
                            return acc;
                        }, {});

                        try {
                            // Create a function with scoped inputs for safe evaluation
                            const result = (() => {
    try {
        const scopedInputs = { ...inputs };
        return new Function(...Object.keys(scopedInputs), `return (${calculation.explanation})`)(...Object.values(scopedInputs));
                                    const func = new Function(...Object.keys(scopedInputs), `return ${calculation.explanation}`);
                                    return func(...Object.values(scopedInputs));
                                } catch (error) {
                                    console.error('Error evaluating calculation:', error, 'Calculation:', calculation.explanation);
                                    return NaN;
                                }
                            })();
                            calculation.result.value = this.humanReadable(result);
                        } catch (error) {
                            console.error('Error evaluating calculation:', error, 'Calculation:', calculation.explanation);
                        }
                    });
                },
                humanReadable(value) {
                    if (value === 0) return '0';
                    if (Math.abs(value) < 1) return value.toString();
                    const units = ['', 'thousand', 'million', 'billion', 'trillion'];
                    const order = Math.floor(Math.log10(Math.abs(value)) / 3);
                    const unitName = units[order] || `10^${order * 3}`;
                    return `${(value / Math.pow(10, 3 * order)).toFixed(2)} ${unitName}`;
                },
                async loadDataFromGist() {
                    try {
                        const gistUrl = 'https://gist.githubusercontent.com/nickmvincent/2c3e4ca38272b1d6b3041dd856e6cab7/raw/5560e727221f298805d731004ea687de24fa60c7/data.yaml';
                        const response = await fetch(gistUrl);
                        if (!response.ok) throw new Error('Failed to load data from Gist');
                        const yamlText = await response.text();
                        const data = jsyaml.load(yamlText);
                        console.log('Data successfully loaded from Gist');
                        this.inputs = data.inputs.reduce((acc, input) => {
    acc[input.variable] = input;
    return acc;
}, {});
                        this.calculations = data.calculations.map(calculation => ({ ...calculation, result: { label: calculation.result.label, value: 0 } }));
                        this.updateCalculations();
                    } catch (e) {
                        console.error('Failed to load data from Gist:', e);
                    }
                }
            },
            mounted() {
                this.loadDataFromGist();
            }
        });

        app.mount('#app');
    </script>
</body>

</html>
